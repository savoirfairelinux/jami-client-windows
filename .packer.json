{
    "BuildType" : "Docker",
    "BuildInstructions" : {
        "win32" : [
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-daemon ring-daemon",
        "cd ring-daemon/contrib",
        "mkdir native",
        "cd native",
        "../bootstrap --host=i686-w64-mingw32",
        "make",
        "cd ../..",
        "./autogen.sh",
        "./configure --host=i686-w64-mingw32 --without-dbus",
        "make",
        "make install",
        "cd ..",
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-lrc ring-lrc",
        "RING=`pwd`/ring-daemon",
        "cd ring-lrc",
        "mkdir build",
        "cd build",
        "cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/winBuild.cmake -DCMAKE_INSTALL_PREFIX=$RING/_win32 -DRING_BUILD_DIR=$RING/src -DENABLE_LIBWRAP=true ..",
        "make",
        "make install",
        "cd ../..",
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-client-windows ring-client-windows",
        "cd ring-client-windows",
        "git fetch https://gerrit-ring.savoirfairelinux.com/ring-client-windows {{REF_NUMBER}} && git checkout FETCH_HEAD",
        "git submodule init && git submodule update",
        "cd winsparkle",
        "git submodule init && git submodule update",
        "mkdir build && cd build",
        "cmake -DCMAKE_TOOLCHAIN_FILE=../../../ring-lrc/cmake/winBuild.cmake -DCMAKE_INSTALL_PREFIX=$RING/_win32 ../cmake",
        "make install",
        "cd ../../libqrencode",
        "./autogen.sh && ./configure --host=i686-w64-mingw32 --prefix=$RING/_win32",
        "make -j4",
        "make install",
        "cd ..",
        "mkdir build && cd build",
        "export QTDIR=/usr/i686-w64-mingw32/sys-root/mingw/lib/qt5",
        "/usr/i686-w64-mingw32/bin/qt5/qmake ../RingWinClient.pro -r -spec win32-g++ RING=$RING/_win32 ENABLE_AUTOUPDATE=True DEFINES+=URI_PROTOCOL",
        "make",
        "make install",
        "cd release",
        "makensis -DARCH=x86 ring.nsi",
        "sudo mv ring-windows-nightly.exe /output"
        ],
        "win64" : [
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-daemon ring-daemon",
        "cd ring-daemon/contrib",
        "mkdir native",
        "cd native",
        "../bootstrap --host=x86_64-w64-mingw32",
        "make",
        "cd ../..",
        "./autogen.sh",
        "./configure --host=x86_64-w64-mingw32 --without-dbus",
        "make",
        "make install",
        "cd ..",
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-lrc ring-lrc",
        "RING=`pwd`/ring-daemon",
        "cd ring-lrc",
        "mkdir build",
        "cd build",
        "cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/winBuild64.cmake -DCMAKE_INSTALL_PREFIX=$RING/_win32 -DRING_BUILD_DIR=$RING/src -DENABLE_LIBWRAP=true ..",
        "make",
        "make install",
        "cd ../..",
        "git clone https://gerrit-ring.savoirfairelinux.com/ring-client-windows ring-client-windows",
        "cd ring-client-windows",
        "git fetch https://gerrit-ring.savoirfairelinux.com/ring-client-windows {{REF_NUMBER}} && git checkout FETCH_HEAD",
        "git submodule init && git submodule update",
        "cd winsparkle",
        "git submodule init && git submodule update",
        "mkdir build && cd build",
        "cmake -DCMAKE_TOOLCHAIN_FILE=../../../ring-lrc/cmake/winBuild64.cmake -DCMAKE_INSTALL_PREFIX=$RING/_win32 ../cmake",
        "make install",
        "cd ../../libqrencode",
        "./autogen.sh && ./configure --host=x86_64-w64-mingw32 --prefix=$RING/_win32",
        "make -j4",
        "make install",
        "cd ..",
        "mkdir build && cd build",
        "export QTDIR=/usr/x86_64-w64-mingw32/sys-root/mingw/lib/qt5",
        "/usr/x86_64-w64-mingw32/bin/qt5/qmake ../RingWinClient.pro -r -spec win32-g++ RING=$RING/_win32 ENABLE_AUTOUPDATE=True DEFINES+=URI_PROTOCOL",
        "make",
        "make install",
        "cd release",
        "makensis -DARCH=x64 ring.nsi",
        "sudo mv ring-windows-nightly.exe /output/ring-windows-nightly_x86_64.exe"
        ]
    },
    "UpdateInstructions" : {
        "win32" : [
            "dnf -y upgrade"
        ],
        "win64" : [
            "dnf -y upgrade"
        ]
    },
    "ReviewType": "Gerrit",
    "ReviewAddress": "https://gerrit-ring.savoirfairelinux.com",
    "Package" : {
        "win32" : "ring-windows-nightly.exe",
        "win64" : "ring-windows-nightly_x86_64.exe"
    },
    "ReloadProjectCmd" : [
        "git checkout packaging",
        "git reset --hard origin/packaging",
        "git pull"
    ],
    "AutoDeploySchedule": {
	"win32": "0 0 0 * * THU",
        "win64": "0 0 0 * * THU"
    },
    "DeployScript": "ring-nightly-windows.sh",
    "NotificationMailAdress": ["Awesome Ring Team", "ring-dev@lists.savoirfairelinux.net"]
}
